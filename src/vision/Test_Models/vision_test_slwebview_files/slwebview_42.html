<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <title>lookForPath_v3_test/Identify Path Elements</title></head><link rel="StyleSheet" href="slwebview.css" type="text/css"><script type="text/javascript" src="id_mapping.js"></script><script type="text/javascript" src="slwebview.js"></script><script type="text/javascript" src="slwebview_utils.js"></script><script type="text/javascript" src="slhtmltoolbar.js"></script><body onload="addToolbar('toolbarDiv');"><table><tr><td><div id="toolbarDiv" style="display:inline"></div></td><td class="content" style="vertical-align:middle">Identify Path Elements</td></tr></table><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd"><span style="color:blue">function</span> [theta_out, rho_out, target_x, target_y, path_found] = path_detection(bw_image_in, hough_table, theta_in, rho_in, threshold)
<span style="color:green">%#eml</span>

<span style="color:green">% This function attempts to identfiy path elements, and returns lines,</span>
<span style="color:green">%   targeting information, and a true/false path_found parameter.</span>
<span style="color:green">%</span>
<span style="color:green">% 5-30-11</span>
<span style="color:green">%</span>
<span style="color:green">% Input</span>
<span style="color:green">%</span>
<span style="color:green">% Output</span>
<span style="color:green">%</span>
<span style="color:green">% Notes:</span>
<span style="color:green">%   The hough_table is destroyed in this function (acceptable if</span>
<span style="color:green">%     hough_table is not an output)</span>


<span style="color:green">% Initialize</span>
peak_tol_ratio = .1;  <span style="color:green">% Fraction of max(rows,cols) of image within which a</span>
<span style="color:green">%                         peak is assumed to reside; this helps reduce</span>
<span style="color:green">%                         incorrect line extraction</span>
max_num_lines = 10;  <span style="color:green">% Considers this many popular lines as candidates</span>

[rho_length, theta_length] = size(hough_table);
[rows, cols] = size(bw_image_in);
rho_tol = .1*max(rows,cols);
theta_tol = 10*pi/180;  <span style="color:green">% Tolerence within which two slopes are equal (radians)</span>

<span style="color:green">%rho_out = zeros(1,3);</span>
<span style="color:green">%theta_out = zeros(1,3);</span>
rho = zeros(1,max_num_lines);
theta = zeros(1,max_num_lines);


<span style="color:green">% Apply appropriate threshold</span>
hough_table = hough_table.*( hough_table &gt; threshold );


<span style="color:green">% Identify the most likely max_num_lines lines</span>
i_index = ones(1,max_num_lines);
j_index = ones(1,max_num_lines);

m = 1;
<span style="color:blue">while</span>( m &lt;= max_num_lines )
    
    max_votes = 0;
    <span style="color:blue">for</span> i = 1:rho_length
        <span style="color:blue">for</span> j = 1:theta_length
            <span style="color:blue">if</span>( hough_table(i,j) &gt; max_votes )
                i_index(m) = i;
                j_index(m) = j;
                max_votes = hough_table(i,j);
            <span style="color:blue">end</span>
        <span style="color:blue">end</span>
    <span style="color:blue">end</span>
    
    rho(m) = rho_in(i_index(m));
    theta(m) = theta_in(j_index(m));
    hough_table(i_index(m),j_index(m)) = 0;
    m = m + 1;
    
<span style="color:blue">end</span>





<span style="color:green">% debug</span>
rho_out = rho;
theta_out = theta;




<span style="color:green">% Extract the three most popular lines that fit the geometric criteria for</span>
<span style="color:green">%   the goalpost</span>
rho_out(1) = rho(1);
theta_out(1) = theta(1);

m = 2;
<span style="color:blue">for</span> i = 2:max_num_lines
    
    <span style="color:green">% If rho, theta do not match within tolerance, then store as the next</span>
    <span style="color:green">%   line</span>
    <span style="color:blue">if</span>( abs(rho(i) - rho(i-1)) &gt;= 30 )
        rho_out(m) = rho(i);
        theta_out(m) = theta(i);
        m = m + 1;
        <span style="color:blue">if</span>( m &gt; 3 )
            <span style="color:blue">break</span>;
        <span style="color:blue">end</span>
    <span style="color:blue">end</span>
    
<span style="color:blue">end</span>



<span style="color:green">% debug</span>
rho_out = rho;
theta_out = theta;
target_x = 0;
target_y = 0;
path_found = 0;


<span style="color:blue">return</span>
</pre></body></html>